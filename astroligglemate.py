import streamlit as st
import openai
import pandas as pd
import json

#sidebar à¸ªà¸³à¸«à¸£à¸±à¸šà¹ƒà¸ªà¹ˆ API Key
user_api_key = st.sidebar.text_input("ðŸ”‘ à¸à¸£à¸¸à¸“à¸²à¸à¸£à¸­à¸ OpenAI API Key (ã……Â´ Ë˜ `)", type="password")

prompt_template = """
à¸ªà¸¡à¸¡à¸•à¸´à¸§à¹ˆà¸²à¸„à¸¸à¸“à¹€à¸›à¹‡à¸™à¸™à¸±à¸à¸žà¸¢à¸²à¸à¸£à¸“à¹Œà¸”à¸§à¸‡à¸—à¸µà¹ˆà¹€à¸™à¹‰à¸™à¸„à¸³à¸—à¸³à¸™à¸²à¸¢à¹à¸šà¸šà¸›à¸±à¹ˆà¸™ à¸‚à¸³à¸‚à¸±à¸™à¸ªà¸¸à¸” à¹† à¸®à¸²à¸™à¹‰à¸³à¸•à¸²à¹€à¸¥à¹‡à¸” 
à¸„à¸¸à¸“à¸ˆà¸°à¹„à¸”à¹‰à¸£à¸±à¸šà¸Šà¸·à¹ˆà¸­à¹€à¸žà¸·à¹ˆà¸­à¸™ à¸§à¸±à¸™à¹€à¸à¸´à¸” (à¸§à¸±à¸™à¹ƒà¸™à¸ªà¸±à¸›à¸”à¸²à¸«à¹Œ) à¹à¸¥à¸°à¸™à¸´à¸ªà¸±à¸¢à¸«à¸£à¸·à¸­à¸žà¸¤à¸•à¸´à¸à¸£à¸£à¸¡à¹€à¸”à¹ˆà¸™à¸‚à¸­à¸‡à¹€à¸žà¸·à¹ˆà¸­à¸™
à¸ªà¸£à¹‰à¸²à¸‡à¸„à¸³à¸—à¸³à¸™à¸²à¸¢à¸ªà¸¸à¸”à¸®à¸²à¹ƒà¸™ 6 à¸«à¸¡à¸§à¸”à¸”à¸±à¸‡à¸™à¸µà¹‰:
1. à¸à¸²à¸£à¸‡à¸²à¸™
2. à¸à¸²à¸£à¹€à¸‡à¸´à¸™
3. à¸ªà¸¸à¸‚à¸ à¸²à¸ž
4. à¸„à¸§à¸²à¸¡à¸£à¸±à¸
5. à¹‚à¸Šà¸„à¸¥à¸²à¸ 
6. Lucky Item à¸›à¸£à¸°à¸ˆà¸³à¸ªà¸±à¸›à¸”à¸²à¸«à¹Œ (à¸„à¸™à¸—à¸µà¹ˆà¹€à¸à¸´à¸”à¹ƒà¸™à¹à¸•à¹ˆà¸¥à¸°à¸§à¸±à¸™à¸ˆà¸°à¹„à¸”à¹‰ Lucky Item à¸•à¹ˆà¸²à¸‡à¸à¸±à¸™à¹„à¸›à¸•à¸²à¸¡à¸™à¸´à¸ªà¸±à¸¢à¸«à¸£à¸·à¸­à¸žà¸¤à¸•à¸´à¸à¸£à¸£à¸¡à¹€à¸”à¹ˆà¸™à¸‚à¸­à¸‡à¹€à¸žà¸·à¹ˆà¸­à¸™à¸—à¸µà¹ˆà¹ƒà¸«à¹‰à¸¡à¸² à¹à¸•à¹ˆà¸ªà¸µà¸‚à¸­à¸‡ item à¸ˆà¸°à¹€à¸«à¸¡à¸·à¸­à¸™à¸à¸±à¸™ à¹‚à¸”à¸¢à¸„à¸™à¹€à¸à¸´à¸”à¸§à¸±à¸™à¸ˆà¸±à¸™à¸—à¸£à¹Œ-à¸ªà¸µà¹€à¸«à¸¥à¸·à¸­à¸‡ à¸§à¸±à¸™à¸­à¸±à¸‡à¸„à¸²à¸£-à¸ªà¸µà¸Šà¸¡à¸žà¸¹ à¸§à¸±à¸™à¸žà¸¸à¸˜-à¸ªà¸µà¹€à¸‚à¸µà¸¢à¸§ à¸§à¸±à¸™à¸žà¸¤à¸«à¸±à¸ªà¸šà¸”à¸µ-à¸ªà¸µà¸ªà¹‰à¸¡ à¸§à¸±à¸™à¸¨à¸¸à¸à¸£à¹Œ-à¸ªà¸µà¸Ÿà¹‰à¸² à¸§à¸±à¸™à¹€à¸ªà¸²à¸£à¹Œ-à¸ªà¸µà¸¡à¹ˆà¸§à¸‡ à¸§à¸±à¸™à¸­à¸²à¸—à¸´à¸•à¸¢à¹Œ-à¸ªà¸µà¹à¸”à¸‡)
à¸ˆà¸²à¸à¸™à¸±à¹‰à¸™à¸ªà¹ˆà¸‡à¸„à¸³à¸—à¸³à¸™à¸²à¸¢à¹ƒà¸™à¸£à¸¹à¸›à¹à¸šà¸š JSON array 
à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡à¹€à¸Šà¹ˆà¸™ à¸„à¸¸à¸“à¹„à¸”à¹‰à¸£à¸±à¸šà¸Šà¸·à¹ˆà¸­à¹€à¸žà¸·à¹ˆà¸­à¸™ "à¹€à¸ˆà¹„à¸”" à¸§à¸±à¸™à¹€à¸à¸´à¸” "à¸§à¸±à¸™à¸­à¸²à¸—à¸´à¸•à¸¢à¹Œ" à¸™à¸´à¸ªà¸±à¸¢à¸«à¸£à¸·à¸­à¸žà¸¤à¸•à¸´à¸à¸£à¸£à¸¡à¹€à¸”à¹ˆà¸™ "à¹‚à¸ªà¸” à¸ªà¸¹à¹‰à¸‡à¸²à¸™ à¸Šà¸­à¸šà¹€à¸¥à¹ˆà¸™à¹€à¸à¸¡" à¸„à¸¸à¸“à¸ˆà¸°à¸•à¹‰à¸­à¸‡à¸ªà¸£à¹‰à¸²à¸‡à¸„à¸³à¸—à¸³à¸™à¸²à¸¢à¹à¸¥à¸°à¸ªà¹ˆà¸‡à¸„à¸³à¸—à¸³à¸™à¸²à¸¢à¹ƒà¸™à¸£à¸¹à¸›à¹à¸šà¸š JSON array à¸—à¸µà¹ˆà¸¡à¸µà¹‚à¸„à¸£à¸‡à¸ªà¸£à¹‰à¸²à¸‡à¸”à¸±à¸‡à¸•à¹ˆà¸­à¹„à¸›à¸™à¸µà¹‰:
[
    {"category": "à¸à¸²à¸£à¸‡à¸²à¸™", "prediction": "à¹€à¸ˆà¹‰à¸²à¸™à¸²à¸¢à¸Šà¸¡à¹€à¸Šà¸¢! ( â€¢ Ì€Ï‰â€¢Ì )âœ§ à¹à¸•à¹ˆà¹„à¸¡à¹ˆà¹„à¸”à¹‰à¸‚à¸¶à¹‰à¸™à¹€à¸‡à¸´à¸™à¹€à¸”à¸·à¸­à¸™ â•¥â€¸â•¥"},
    {"category": "à¸à¸²à¸£à¹€à¸‡à¸´à¸™", "prediction": "à¹„à¸”à¹‰à¹€à¸‡à¸´à¸™à¸¡à¸²à¹„à¸§ãƒ¾(ï½¡âœªÏ‰âœªï½¡)ï½¼ðŸ’° à¹à¸•à¹ˆà¸«à¸¡à¸”à¹„à¸›à¹„à¸§à¸à¸§à¹ˆà¸² âˆ˜ âˆ˜ âˆ˜ ðŸ’¸( Â°ãƒ®Â° ) ?"},
    {"category": "à¸ªà¸¸à¸‚à¸ à¸²à¸ž", "prediction": "à¸›à¸§à¸”à¸«à¸¥à¸±à¸‡à¹€à¸žà¸£à¸²à¸°à¸™à¸±à¹ˆà¸‡à¹€à¸¥à¹ˆà¸™à¹€à¸à¸¡à¸¢à¸±à¸™à¹€à¸Šà¹‰à¸² ( Tá—œT)ðŸŽ®"},
    {"category": "à¸„à¸§à¸²à¸¡à¸£à¸±à¸", "prediction": "à¸„à¸™à¹‚à¸ªà¸”à¸ˆà¸°à¹€à¸ˆà¸­à¸„à¸™à¸–à¸¹à¸à¹ƒà¸ˆ (ï½¡>\\<) à¹à¸•à¹ˆà¹€à¸‚à¸²à¸”à¸±à¸™à¸¡à¸µà¹à¸Ÿà¸™à¹à¸¥à¹‰à¸§..."},
    {"category": "à¹‚à¸Šà¸„à¸¥à¸²à¸ ", "prediction": "à¹‚à¸Šà¸„à¸¥à¸²à¸ à¸à¸³à¸¥à¸±à¸‡à¸£à¸­à¸„à¸¸à¸“à¸­à¸¢à¸¹à¹ˆà¹ƒà¸™à¸¡à¸¸à¸¡à¸—à¸µà¹ˆà¹„à¸¡à¹ˆà¸„à¸²à¸”à¸„à¸´à¸”â€”à¸­à¸²à¸ˆà¸ˆà¸°à¹€à¸›à¹‡à¸™à¹€à¸‡à¸´à¸™à¹ƒà¸™à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¸‹à¸±à¸à¸œà¹‰à¸²à¸—à¸µà¹ˆà¸¥à¸·à¸¡à¸«à¸¢à¸´à¸šà¸­à¸­à¸à¸ˆà¸²à¸à¸à¸£à¸°à¹€à¸›à¹‹à¸²à¸à¸²à¸‡à¹€à¸à¸‡!ðŸ§ºðŸ§¼"},
    {"category": "Lucky Item à¸›à¸£à¸°à¸ˆà¸³à¸ªà¸±à¸›à¸”à¸²à¸«à¹Œ", "prediction": "à¹à¸à¹‰à¸§à¸à¸²à¹à¸Ÿà¸ªà¸µà¹à¸”à¸‡ à¹€à¸•à¸´à¸¡à¸„à¸²à¹€à¸Ÿà¸­à¸µà¸™à¹ƒà¸«à¹‰à¸ªà¸¡à¸­à¸‡à¸žà¸£à¹‰à¸­à¸¡à¸ªà¸¹à¹‰à¸‡à¸²à¸™...à¸«à¸¥à¸±à¸‡à¸ˆà¸²à¸à¸•à¸šà¸•à¸µà¸šà¸­à¸ªà¹ƒà¸™à¹€à¸à¸¡à¸¡à¸²à¸—à¸±à¹‰à¸‡à¸„à¸·à¸™â€”â˜•(â‰–_â‰– )"}
]
à¹„à¸¡à¹ˆà¸•à¹‰à¸­à¸‡à¸­à¸˜à¸´à¸šà¸²à¸¢à¹€à¸žà¸´à¹ˆà¸¡à¹€à¸•à¸´à¸¡ à¸ªà¹ˆà¸‡à¹à¸„à¹ˆ JSON array à¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™
"""

#à¸ªà¹ˆà¸§à¸™à¸«à¸±à¸§à¸‚à¸­à¸‡à¹à¸­à¸›
st.title("à¸£à¸°à¸šà¸šà¸žà¸¢à¸²à¸à¸£à¸“à¹Œà¸”à¸§à¸‡à¹€à¸žà¸·à¹ˆà¸­à¸™à¹à¸šà¸šà¸›à¸±à¹ˆà¸™ ðŸ”¥ðŸ”®ðŸŒŸ")
st.write("à¸à¸£à¸­à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸žà¸·à¹ˆà¸­à¸™à¸‚à¸­à¸‡à¸„à¸¸à¸“ ðŸ‘§ðŸ»ðŸ§’ðŸ»ðŸ’ž (à¸à¸£à¸­à¸à¹„à¸”à¹‰à¸¡à¸²à¸à¸à¸§à¹ˆà¸² 1 à¸„à¸™ à¸ªà¸¹à¸‡à¸ªà¸¸à¸” 5 à¸„à¸™) à¹€à¸žà¸·à¹ˆà¸­à¸”à¸¹à¸„à¸³à¸—à¸³à¸™à¸²à¸¢à¸ªà¸¸à¸”à¸®à¸²!")

#à¸à¸£à¸­à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸žà¸·à¹ˆà¸­à¸™à¸—à¸µà¸¥à¸°à¸„à¸™ (à¸ªà¸¹à¸‡à¸ªà¸¸à¸” 5 à¸„à¸™)
friends_data = []
for i in range(1, 6):
    st.subheader(f"à¹€à¸žà¸·à¹ˆà¸­à¸™à¸„à¸™à¸—à¸µà¹ˆ {i} ðŸƒðŸ»â€â™‚ï¸ðŸ’¨")
    friend_name = st.text_input(f"à¸Šà¸·à¹ˆà¸­à¹€à¸žà¸·à¹ˆà¸­à¸™à¸„à¸™à¸—à¸µà¹ˆ {i}", key=f"name_{i}")
    birthday = st.selectbox(
        f"à¸§à¸±à¸™à¹€à¸à¸´à¸”à¸„à¸™à¸—à¸µà¹ˆ {i}", 
        ["à¸§à¸±à¸™à¸­à¸²à¸—à¸´à¸•à¸¢à¹Œ", "à¸§à¸±à¸™à¸ˆà¸±à¸™à¸—à¸£à¹Œ", "à¸§à¸±à¸™à¸­à¸±à¸‡à¸„à¸²à¸£", "à¸§à¸±à¸™à¸žà¸¸à¸˜", "à¸§à¸±à¸™à¸žà¸¤à¸«à¸±à¸ªà¸šà¸”à¸µ", "à¸§à¸±à¸™à¸¨à¸¸à¸à¸£à¹Œ", "à¸§à¸±à¸™à¹€à¸ªà¸²à¸£à¹Œ"], 
        key=f"birthday_{i}"
    )
    behavior = st.text_input(
        f"à¸™à¸´à¸ªà¸±à¸¢à¸«à¸£à¸·à¸­à¸žà¸¤à¸•à¸´à¸à¸£à¸£à¸¡à¹€à¸”à¹ˆà¸™à¸‚à¸­à¸‡à¹€à¸žà¸·à¹ˆà¸­à¸™à¸„à¸™à¸—à¸µà¹ˆ {i} (à¹ƒà¸ªà¹ˆà¹„à¸”à¹‰à¸¡à¸²à¸à¸à¸§à¹ˆà¸² 1 à¸¥à¸±à¸à¸©à¸“à¸°)", 
        placeholder="à¹€à¸Šà¹ˆà¸™ à¸Šà¸­à¸šà¹€à¸šà¸µà¹‰à¸¢à¸§à¸™à¸±à¸” à¹€à¸¡à¸²à¹à¸¥à¹‰à¸§à¹€à¸„à¸¢à¸­à¸¸à¹‰à¸¡à¸«à¸¡à¸²à¸à¸¥à¸±à¸šà¸šà¹‰à¸²à¸™ à¸•à¸´à¸”à¹à¸Ÿà¸™", 
        key=f"behavior_{i}"
    )
    if friend_name and birthday and behavior:
        friends_data.append({
            "name": friend_name,
            "birthday": birthday,
            "behavior": behavior
        })

#à¸•à¸±à¸§à¹€à¸¥à¸·à¸­à¸à¹à¸›à¸¥à¸ à¸²à¸©à¸²à¹€à¸žà¸´à¹ˆà¸¡
translate_option = st.selectbox("ðŸŒ à¹€à¸žà¸´à¹ˆà¸¡à¸„à¸³à¹à¸›à¸¥à¸ à¸²à¸©à¸²à¸­à¸·à¹ˆà¸™à¹ƒà¸™à¸„à¸³à¸—à¸³à¸™à¸²à¸¢à¹„à¸«à¸¡?", ["à¹à¸„à¹ˆà¸ à¸²à¸©à¸²à¹„à¸—à¸¢à¸à¹‡à¸žà¸­à¹à¸¥à¹‰à¸§ ðŸ˜Ž", "English", "ç®€ä½“ä¸­æ–‡", "EspaÃ±ol"])

#à¸›à¸¸à¹ˆà¸¡à¸à¸”à¹€à¸žà¸·à¹ˆà¸­à¸‚à¸­à¸„à¸³à¸—à¸³à¸™à¸²à¸¢
if st.button("(à¹‘'áµ•'à¹‘)â¸*ðŸ”® à¸”à¸¹à¸”à¸§à¸‡à¸‡!"):
    if not user_api_key:
        st.error("à¸à¸£à¸¸à¸“à¸²à¹ƒà¸ªà¹ˆ API Key à¸à¹ˆà¸­à¸™à¸™à¸°à¸‡à¸±à¹‰à¸Ÿ! (ã…… â€¢á·„ â‚ƒâ€¢á·… )")
    elif not friends_data:
        st.error("à¸à¸£à¸¸à¸“à¸²à¸à¸£à¸­à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸žà¸·à¹ˆà¸­à¸™à¹ƒà¸«à¹‰à¸„à¸£à¸šà¸­à¸¢à¹ˆà¸²à¸‡à¸™à¹‰à¸­à¸¢ 1 à¸„à¸™à¸™à¹‰à¸²~ (ï½¡- .â€¢Ì€ )âŸ¡Ë– à£ªâ‹†")
    else:
        st.info("â³ à¸à¸³à¸¥à¸±à¸‡à¸ªà¸£à¹‰à¸²à¸‡à¹€à¸£à¸·à¹ˆà¸­à¸‡ à¹€à¸­à¹‰à¸¢! à¸ªà¸£à¹‰à¸²à¸‡à¸„à¸³à¸—à¸³à¸™à¸²à¸¢... à¹‚à¸›à¸£à¸”à¸£à¸­à¸ªà¸±à¸à¸„à¸£à¸¹à¹ˆ à¸•à¸£à¸¹à¹‰à¸”à¹†")
        
        client = openai.OpenAI(api_key=user_api_key)
        results = []
        for friend in friends_data:
            name, birthday, behavior = friend["name"], friend["birthday"], friend["behavior"]
            messages = [
                {"role": "system", "content": prompt_template},
                {"role": "user", "content": f"à¸Šà¸·à¹ˆà¸­: {name}, à¸§à¸±à¸™à¹€à¸à¸´à¸”: {birthday}, à¸™à¸´à¸ªà¸±à¸¢: {behavior}"}
            ]

            try:
                response = client.chat.completions.create(
                    model="gpt-4o-mini",
                    messages=messages, 
                    temperature=0.9
                )
                horoscope_json = response.choices[0].message.content
                horoscope_list = json.loads(horoscope_json)

                for prediction in horoscope_list:
                    results.append({
                        "Name": name,
                        "Birthday": birthday,
                        "Behavior": behavior,
                        "Category": prediction["category"],
                        "Prediction": prediction["prediction"]
                    })

                #à¹à¸›à¸¥à¸ à¸²à¸©à¸² (à¸–à¹‰à¸²à¸¡à¸µà¸à¸²à¸£à¹€à¸¥à¸·à¸­à¸)
                if translate_option != "à¹à¸„à¹ˆà¸ à¸²à¸©à¸²à¹„à¸—à¸¢à¸à¹‡à¸žà¸­à¹à¸¥à¹‰à¸§ ðŸ˜Ž":
                    for prediction in horoscope_list:
                        lang_mapping = {
                            "English": "English",
                            "ç®€ä½“ä¸­æ–‡": "Simplified Chinese",
                            "EspaÃ±ol": "Spanish"
                        }

                        translation_prompt = f"""
                        à¸ªà¸¡à¸¡à¸•à¸´à¸§à¹ˆà¸²à¸„à¸¸à¸“à¹€à¸›à¹‡à¸™à¸™à¸±à¸à¹à¸›à¸¥à¸¡à¸·à¸­à¸­à¸²à¸Šà¸µà¸žà¸—à¸µà¹ˆà¸¡à¸µà¸„à¸§à¸²à¸¡à¸ªà¸²à¸¡à¸²à¸£à¸–à¸”à¹‰à¸²à¸™à¸à¸²à¸£à¸ªà¸·à¹ˆà¸­à¸ªà¸²à¸£à¸£à¸°à¸”à¸±à¸šà¸ªà¸¹à¸‡  
                        à¸„à¸¸à¸“à¸ˆà¸°à¹„à¸”à¹‰à¸£à¸±à¸šà¸„à¸³à¸—à¸³à¸™à¸²à¸¢à¸”à¸§à¸‡à¸ªà¸¸à¸”à¸®à¸² 1 à¸£à¸²à¸¢à¸à¸²à¸£à¹ƒà¸™à¸ à¸²à¸©à¸²à¹„à¸—à¸¢  
                        à¸ªà¸´à¹ˆà¸‡à¸—à¸µà¹ˆà¸„à¸¸à¸“à¸•à¹‰à¸­à¸‡à¸—à¸³à¸¡à¸µà¸”à¸±à¸‡à¸™à¸µà¹‰:
                        1. à¹à¸›à¸¥à¸„à¸³à¸—à¸³à¸™à¸²à¸¢à¹ƒà¸«à¹‰à¸¡à¸µà¸„à¸§à¸²à¸¡à¸–à¸¹à¸à¸•à¹‰à¸­à¸‡ à¹à¸•à¹ˆà¸¢à¸±à¸‡à¸„à¸‡à¸£à¸±à¸à¸©à¸²à¸­à¸²à¸£à¸¡à¸“à¹Œà¸‚à¸±à¸™à¹à¸¥à¸°à¹‚à¸—à¸™à¸—à¸µà¹ˆà¹€à¸›à¹‡à¸™à¸¡à¸´à¸•à¸£à¸‚à¸­à¸‡à¸•à¹‰à¸™à¸‰à¸šà¸±à¸šà¹„à¸§à¹‰
                        2. à¸—à¸³à¹ƒà¸«à¹‰à¸„à¸³à¹à¸›à¸¥à¸­à¹ˆà¸²à¸™à¸¥à¸·à¹ˆà¸™à¹„à¸«à¸¥à¹à¸¥à¸°à¸”à¸¹à¹€à¸›à¹‡à¸™à¸˜à¸£à¸£à¸¡à¸Šà¸²à¸•à¸´à¹ƒà¸™à¸ à¸²à¸©à¸²à¸—à¸µà¹ˆà¸à¸³à¸«à¸™à¸”
                        3. à¸«à¸¥à¸µà¸à¹€à¸¥à¸µà¹ˆà¸¢à¸‡à¸à¸²à¸£à¹à¸›à¸¥à¸—à¸µà¹ˆà¸•à¸£à¸‡à¸•à¸±à¸§à¸ˆà¸™à¹€à¸à¸´à¸™à¹„à¸› à¹ƒà¸«à¹‰à¹à¸›à¸¥à¹ƒà¸™à¸¥à¸±à¸à¸©à¸“à¸°à¸—à¸µà¹ˆà¹€à¸‚à¹‰à¸²à¹ƒà¸ˆà¸‡à¹ˆà¸²à¸¢à¹à¸¥à¸°à¸ªà¸™à¸¸à¸à¸ªà¸™à¸²à¸™  

                        à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡à¸à¸²à¸£à¹à¸›à¸¥:
                        à¸„à¸³à¸•à¹‰à¸™à¸‰à¸šà¸±à¸š: "à¹€à¸ˆà¹‰à¸²à¸™à¸²à¸¢à¸Šà¸¡à¹€à¸Šà¸¢! ( â€¢ Ì€Ï‰â€¢Ì )âœ§ à¹à¸•à¹ˆà¹„à¸¡à¹ˆà¹„à¸”à¹‰à¸‚à¸¶à¹‰à¸™à¹€à¸‡à¸´à¸™à¹€à¸”à¸·à¸­à¸™ â•¥â€¸â•¥"
                        à¸ à¸²à¸©à¸²à¸­à¸±à¸‡à¸à¸¤à¸©: "Your boss gave you a compliment! ( â€¢ Ì€Ï‰â€¢Ì )âœ§ But nope, still no raise â•¥â€¸â•¥"
                        à¸ à¸²à¸©à¸²à¸ˆà¸µà¸™à¸•à¸±à¸§à¸¢à¹ˆà¸­: "è€æ¿è¡¨æ‰¬äº†ä½ ï¼( â€¢ Ì€Ï‰â€¢Ì )âœ§ å¯æƒœæ²¡ç»™åŠ è–ª â•¥â€¸â•¥"
                        à¸ à¸²à¸©à¸²à¸ªà¹€à¸›à¸™: "Â¡Tu jefe te elogiÃ³! ( â€¢ Ì€Ï‰â€¢Ì )âœ§ Pero no hay aumento de sueldo â•¥â€¸â•¥"

                        à¸ªà¹ˆà¸‡à¹€à¸‰à¸žà¸²à¸°à¸„à¸³à¹à¸›à¸¥à¹ƒà¸™à¸ à¸²à¸©à¸²à¸—à¸µà¹ˆà¸à¸³à¸«à¸™à¸”à¹€à¸—à¹ˆà¸²à¸™à¸±à¹‰à¸™: {lang_mapping[translate_option]}
                        à¸„à¸³à¸—à¸³à¸™à¸²à¸¢: {prediction['prediction']}
                        """

                        translation_response = client.chat.completions.create(
                            model="gpt-4o-mini",
                            messages=[{"role": "user", "content": translation_prompt}]
                        )
                        prediction[f"Prediction_{translate_option}"] = translation_response.choices[0].message.content
                    results.append(prediction)


            except Exception as e:
                st.error(f"à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸žà¸¥à¸²à¸”à¹ƒà¸™à¸à¸²à¸£à¸›à¸£à¸°à¸¡à¸§à¸¥à¸œà¸¥à¸„à¸³à¸—à¸³à¸™à¸²à¸¢à¸ªà¸³à¸«à¸£à¸±à¸š {name}: {str(e)}")
                results.append({
                    "Name": name,
                    "Birthday": birthday,
                    "Behavior": behavior,
                    "Category": "Error",
                    "Prediction": str(e)
                })

        #à¸ªà¸£à¹‰à¸²à¸‡ DataFrame
        df = pd.DataFrame(results)

        #à¹à¸ªà¸”à¸‡à¸œà¸¥
        st.subheader("ðŸ“‹ à¸„à¸³à¸—à¸³à¸™à¸²à¸¢à¹ƒà¸™à¸£à¸¹à¸›à¹à¸šà¸šà¸•à¸²à¸£à¸²à¸‡ ðŸ”®")
        st.dataframe(df)
       

        #à¸”à¸²à¸§à¸™à¹Œà¹‚à¸«à¸¥à¸” CSV
        csv = df.to_csv(index=False, encoding='utf-8-sig').encode('utf-8-sig')
        st.download_button(
            label="ðŸ“¥ à¸”à¸²à¸§à¸™à¹Œà¹‚à¸«à¸¥à¸”à¸„à¸³à¸—à¸³à¸™à¸²à¸¢ (CSV)",
            data=csv,
            file_name="astroligglemate_result.csv",
            mime='text/csv'
        )
